{{define "title"}}Dashboard - Bluesky Archive{{end}}

{{define "nav"}}
<nav class="container">
    <ul>
        <li><strong>Bluesky Archive</strong></li>
    </ul>
    <ul>
        <li><a href="/dashboard">Dashboard</a></li>
        <li><a href="/archive">Archive</a></li>
        <li><a href="/browse">Browse</a></li>
        <li><a href="/about">About</a></li>
        <li><a href="/auth/logout">Logout</a></li>
    </ul>
</nav>
{{end}}

{{define "content"}}
<section>
    <hgroup>
        <h1>Welcome, {{.Session.Handle}}</h1>
        <h2>Dashboard</h2>
    </hgroup>

    {{if .Status}}
    <div class="grid">
        <article>
            <header><strong>Archive Statistics</strong></header>
            <p>Posts: <strong>{{.Status.TotalPosts}}</strong></p>
            <p>Media files: <strong>{{.Status.TotalMedia}}</strong></p>
            <p>Posts with media: <strong>{{.Status.PostsWithMedia}}</strong></p>
            <p>Replies: <strong>{{.Status.RepliesCount}}</strong></p>
            {{if .Status.TotalArchiveSize}}
            <p>Total size: <strong>{{printf "%.2f" .Status.ArchiveSizeMB}} MB</strong></p>
            {{end}}
        </article>

        <article>
            <header><strong>Timeline</strong></header>
            {{if .Status.OldestPost}}
            <p>Oldest post: {{.Status.OldestPost.Format "Jan 2, 2006"}}</p>
            {{end}}
            {{if .Status.NewestPost}}
            <p>Newest post: {{.Status.NewestPost.Format "Jan 2, 2006"}}</p>
            {{end}}
            {{if .Status.LastSuccessfulAt}}
            <p>Last sync: {{.Status.LastSuccessfulAt.Format "Jan 2, 2006 15:04"}}</p>
            {{else}}
            <p>Last sync: <em>Never</em></p>
            {{end}}
        </article>
    </div>

    {{if .Status.ActiveOperation}}
    <article>
        <header><strong>Active Operation</strong></header>
        <p>Status: <strong>{{.Status.ActiveOperation.Status}}</strong></p>
        <p>Type: {{.Status.ActiveOperation.Type}}</p>
        {{if gt .Status.ActiveOperation.ProgressTotal 0}}
        <progress value="{{.Status.ActiveOperation.ProgressCurrent}}" max="{{.Status.ActiveOperation.ProgressTotal}}"></progress>
        <p>Progress: {{.Status.ActiveOperation.ProgressCurrent}} / {{.Status.ActiveOperation.ProgressTotal}} ({{printf "%.1f" .Status.ActiveOperation.ProgressPercentage}}%)</p>
        {{else}}
        <progress></progress>
        <p>Starting...</p>
        {{end}}
        <footer>
            <a href="/archive" role="button">View Details</a>
        </footer>
    </article>
    {{end}}
    {{else}}
    <article>
        <header><strong>Getting Started</strong></header>
        <p>No archive data yet. Start your first archive operation to fetch your posts.</p>
        <ol>
            <li>Go to the <a href="/archive">Archive</a> page</li>
            <li>Click "Start Archive" to fetch your posts</li>
            <li>Browse and search your archived content</li>
        </ol>
        <footer>
            <a href="/archive" role="button">Get Started</a>
        </footer>
    </article>
    {{end}}

    <article>
        <header><strong>Quick Actions</strong></header>
        <div class="grid">
            <a href="/archive" role="button">Manage Archive</a>
            <a href="/browse" role="button" class="secondary">Browse Posts</a>
        </div>
    </article>
</section>
{{end}}
