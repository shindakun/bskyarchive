{{define "archive-status"}}
{{if .Status}}
<article>
    <header><strong>Archive Status</strong></header>

    {{if .Status.ActiveOperation}}
    <div>
        <p><strong>Operation in Progress</strong></p>
        <p>Type: {{.Status.ActiveOperation.Type}}</p>
        <p>Status: <mark>{{.Status.ActiveOperation.Status}}</mark></p>

        {{if gt .Status.ActiveOperation.ProgressTotal 0}}
        <progress value="{{.Status.ActiveOperation.ProgressCurrent}}" max="{{.Status.ActiveOperation.ProgressTotal}}"></progress>
        <p>Progress: {{.Status.ActiveOperation.ProgressCurrent}} / {{.Status.ActiveOperation.ProgressTotal}} posts ({{printf "%.1f" .Status.ActiveOperation.ProgressPercentage}}%)</p>
        {{else}}
        <progress></progress>
        <p>Initializing...</p>
        {{end}}

        <p><small>Started: {{.Status.ActiveOperation.StartedAt.Format "Jan 2, 2006 15:04:05"}}</small></p>
    </div>
    {{else}}
    <div>
        <p><strong>No Active Operations</strong></p>

        {{if gt .Status.TotalPosts 0}}
        <div class="grid">
            <div>
                <p>Total Posts: <strong>{{.Status.TotalPosts}}</strong></p>
                <p>Media Files: <strong>{{.Status.TotalMedia}}</strong></p>
            </div>
            <div>
                {{if .Status.LastSuccessfulAt}}
                <p>Last Sync: {{.Status.LastSuccessfulAt.Format "Jan 2, 2006 15:04"}}</p>
                {{else}}
                <p>Last Sync: <em>Never</em></p>
                {{end}}
            </div>
        </div>
        {{else}}
        <p>No posts archived yet. Start an archive operation to begin.</p>
        {{end}}
    </div>
    {{end}}
</article>

<!-- Recent Operations - Now included in polling -->
{{if .Status.RecentOperations}}
<article>
    <header><strong>Recent Operations</strong></header>
    <figure>
        <table role="grid">
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Status</th>
                    <th>Started</th>
                    <th>Completed</th>
                    <th>Progress</th>
                </tr>
            </thead>
            <tbody>
                {{range .Status.RecentOperations}}
                <tr>
                    <td>{{.Type}}</td>
                    <td>{{.Status}}</td>
                    <td>{{.StartedAt.Format "Jan 2 15:04"}}</td>
                    <td>
                        {{if .CompletedAt}}
                        {{.CompletedAt.Format "Jan 2 15:04"}}
                        {{else}}
                        -
                        {{end}}
                    </td>
                    <td>
                        {{if .IsComplete}}
                        {{.ProgressCurrent}} posts
                        {{else if gt .ProgressTotal 0}}
                        {{.ProgressCurrent}} / {{.ProgressTotal}} ({{printf "%.0f" .ProgressPercentage}}%)
                        {{else}}
                        Starting...
                        {{end}}
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </figure>
</article>
{{end}}
{{else}}
<article>
    <header><strong>Archive Status</strong></header>
    <p>Loading...</p>
</article>
{{end}}
{{end}}
